<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–õ–æ–±–±–∏</title>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –≤–Ω–µ—à–Ω–∏–π CSS -->
    <link rel="stylesheet" href="/static/style.css">
    <!-- –ö–∞—Ä—Ç–∞ –∏–º–ø–æ—Ä—Ç–æ–≤ –¥–ª—è Three.js -->
    <script type="importmap">
      {
        "imports": {
          "three": "https://unpkg.com/three@0.128.0/build/three.module.js"
        }
      }
    </script>
    <!-- Socket.IO –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–≥—Ä—É–∂–µ–Ω –î–û lobby.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
</head>
<body>
    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è 3D-—Å—Ü–µ–Ω—ã -->
    <div id="canvas-container" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1;"></div>

    <!-- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–≤–µ—Ä—Ö 3D -->
    <div class="ui-overlay">
         <!-- –õ–µ–≤–∞—è –≤–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å: —Å–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ (—Å–≤–æ—Ä–∞—á–∏–≤–∞–µ–º—ã–π) -->
        <div class="participants-panel" id="participants-panel">
            <div class="panel-header">
                <span>–£—á–∞—Å—Ç–Ω–∏–∫–∏</span>
                <span class="toggle-icon">‚ñº</span>
            </div>
            <div class="participants-content">
                <div class="online-section">
                    <h4>–í —Å–µ—Ç–∏</h4>
                    <ul id="online-participants"></ul>
                </div>
                <div class="offline-section">
                    <h4>–ù–µ –≤ —Å–µ—Ç–∏</h4>
                    <ul id="offline-participants"></ul>
                </div>
            </div>
        </div>

        <!-- –ü—Ä–∞–≤–∞—è –≤–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å: –º–µ–Ω—é –ª–æ–±–±–∏ -->
        <div class="lobby-menu">
            <div class="menu-item lobby-name">–õ–æ–±–±–∏: <span id="lobby-name">–ó–∞–≥—Ä—É–∑–∫–∞...</span></div>
            <div class="menu-item invite-code" id="gm-invite-code" style="display:none;">–ö–æ–¥: <span id="invite-code-value"></span></div>
                <button class="menu-item edit-toggle" id="edit-toggle" style="display:none;" onclick="toggleEditMode()" title="–†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞—Ä—Ç—ã">‚úèÔ∏è</button>
            <button class="menu-item settings-btn" id="settings-btn" style="display:none;" onclick="toggleSettings()" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ–±–±–∏">‚öôÔ∏è</button>
            <button class="menu-item exit-btn" onclick="leaveLobby()" title="–ü–æ–∫–∏–Ω—É—Ç—å –ª–æ–±–±–∏">‚úï</button>
        </div>
        <div id="settings-panel" class="settings-panel" style="display:none;">
            <div class="settings-header">
                <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ–±–±–∏</span>
                <button onclick="closeSettings()" style="background:none; border:none; color:white; font-size:1.2rem; cursor:pointer;">‚úï</button>
            </div>
            <div class="settings-tabs">
                <button class="tab-btn active" onclick="showSettingsTab('banned')">–ó–∞–±–∞–Ω–µ–Ω–Ω—ã–µ</button>
                <!-- –ó–¥–µ—Å—å –ø–æ–∑–∂–µ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∏–µ –≤–∫–ª–∞–¥–∫–∏ -->
            </div>
            <div id="settings-content">
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –ø–æ–¥–≥—Ä—É–∂–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>

        <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å: —á–∞—Ç -->
        <div class="chat-panel">
            <div class="panel-header">–ß–∞—Ç</div>
            <div id="chat" class="chat-messages"></div>
            <div class="chat-input-area">
                <input type="text" id="message-input" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...">
                <button class="btn btn-primary" onclick="sendMessage()">‚Üí</button>
            </div>
        </div>

        <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å (–¥–ª—è –±—É–¥—É—â–∏—Ö —Ñ–∏—á, –ø–æ–∫–∞ –ø—É—Å—Ç–∞—è) -->
        <div class="right-panel">
            <div class="panel-header">–ü–µ—Ä—Å–æ–Ω–∞–∂–∏</div>
            <button class="btn btn-primary btn-sm" onclick="showCreateCharacterForm()" style="margin-bottom: 10px;">+ –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</button>
            <div id="lobby-characters-list" class="characters-list"></div>
        </div>

        <!-- –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ–π -->
        <div class="map-tools">
            <div class="marker-types">
                <button class="marker-btn red" onclick="setMarkerType('default')">üî¥</button>
                <button class="marker-btn blue" onclick="setMarkerType('blue')">üîµ</button>
                <button class="marker-btn green" onclick="setMarkerType('green')">üü¢</button>
                <span>–¢–∏–ø: <span id="current-marker-type">default</span></span>
            </div>
            <button class="btn btn-primary" onclick="addMarkerAtCenter()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–∫—É</button>
                <div class="tile-palette" style="display: inline-block; margin-left: 15px; border-left: 1px solid #444; padding-left: 15px;">
                    <span>–¢–∏–ø —Ç–∞–π–ª–∞:</span>
                    <select id="tile-type-select" class="character-select" style="width: auto;">
                        <option value="grass">üåø –¢—Ä–∞–≤–∞</option>
                        <option value="forest">üå≤ –õ–µ—Å</option>
                        <option value="house">üè† –î–æ–º</option>
                        <option value="water">üíß –í–æ–¥–∞</option>
                    </select>
                </div>
        </div>

        <div id="visibility-modal" class="modal" style="display:none;">
            <div class="modal-content">
                <span class="close" onclick="closeVisibilityModal()">&times;</span>
                <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</h3>
                <p id="visibility-character-name"></p>
                <div id="visibility-participants-list"></div>
                <button onclick="saveVisibility()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–∞–π–ª–µ -->
        <div id="tile-info" style="position: absolute; bottom: 100px; right: 20px; background: rgba(0,0,0,0.7); color: white; padding: 10px; border-radius: 8px; display: none; pointer-events: none; z-index: 5;">
            <div id="tile-info-content"></div>
        </div>

    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –ª–æ–±–±–∏ (–º–æ–¥—É–ª—å) -->
    <script type="module" src="/static/lobby.js"></script>
</body>
</html>